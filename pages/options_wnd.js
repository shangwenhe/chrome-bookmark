import{CurCVer_ as e,CurFFVer_ as t,OnFirefox as i,OnChrome as n,OnEdge as o,$ as l,$$ as r,post_ as a,disconnect_ as s,isVApiReady_ as u,simulateClick_ as c,PageOs_ as d,toggleDark_ as p,browser_ as f,selfTabId_ as m,enableNextTick_ as h,nextTick_ as k,IsEdg_ as w,import2_ as b,BrowserName_ as A,pageTrans_ as V,isRepeated_ as g,prevent_ as v}from"./async_bg.js";import{bgSettings_ as y,showI18n_ as _,setupBorderWidth_ as x,Option_ as T,debounce_ as C,oTrans_ as E,delayBinding_ as I,didBindEvent_ as M}from"./options_base.js";import{saveBtn_ as S,exportBtn_ as j,savedStatus_ as H,onKeyMappingsError_ as $}from"./options_defs.js";import{manifest_ as O}from"./options_permissions.js";export let delayed_task;export const clear_delayed_task=()=>{delayed_task=null};h(8),k(_),x&&k(x),k(e=>{e.textContent=O.version_name||O.version,parseInt(O.version)>=2!=(3===O.manifest_version)&&(e.parentElement.nextElementSibling.textContent="-mv"+O.manifest_version)},l("#version")),I(S,"click",e=>{if(false!==e)return void T.ht().then(e=>{e&&S.onclick(false)});let t=T.F;T.F=[],S.disabled=true,S.firstChild.data=E("115_3"),j.disabled=false,H(false),window.onbeforeunload=null,window.addEventListener("beforeunload",L,true),0!==t.length&&setTimeout(e=>{a(4,e.map(e=>y.f[e]))},100,t)},"on");let L=()=>{a(30)},P=function(){T.$=false;for(let e in T.D)T.D[e].w();T.D.exclusionRules.S.length>0&&k(e=>{e.style.visibility=""},l("#exclusionToolbar")),document.addEventListener("keyup",F),I("[data-check]","input",function e(){for(let t of r("[data-check]"))t.removeEventListener("input",e);b("./options_checker.js")}),I("[data-auto-resize]","click",e=>{let t=l("#"+e.target.dataset.autoResize),i=t.scrollHeight,n=t.scrollWidth,o=n-t.clientWidth;if(i<=t.clientHeight&&o<=0)return;let r=Math.max(Math.min(innerWidth,1024)-120,550);t.style.maxWidth=n>r?r+"px":"",t.style.height=t.style.width="",o=n-t.clientWidth;let a=t.offsetHeight-t.clientHeight;a=o>0?Math.max(26,a):a+18,i+=a,o>0&&(t.style.width=t.offsetWidth+o+4+"px"),t.style.height=i+"px"}),I("[data-delay]","click",function(e){let t=this.dataset.delay,i=null;"event"===t&&(i=e||null),"continue"!==t&&e&&v(e),delayed_task=["#"+this.id,i],"complete"!==document.readyState?window.addEventListener("load",function e(t){t.target===document&&(window.removeEventListener("load",e),b("./options_ext.js"))}):b("./options_ext.js")},"on");let t=r("[data-permission]");t.length>0&&(t=>{function i(){let e=this.querySelector("[data-permission]");if(this.onclick=null,!e)return;let t=e.dataset.permission;e.placeholder=E("lackPermission",[t?`: "${t}"`:""])}let n=O.permissions||[];for(let o=t.length;0<=--o;){let l,r=t[o],a=r.dataset.permission;if("C"===a[0]){if(e>=parseInt(a.slice(1)))continue;let t=a.split(",",2)[1]||",";if("."===t[0]?null!=window[t.slice(1)]:"("===t[0]&&matchMedia(t).matches)continue;l=["beforeChromium",[a.slice(1).split(",",1)[0]]]}else{if("mv3,nonFF"===a)continue;if(a in O||n.includes(a))continue;l=["lackPermission",[a?":\n* "+a:""]]}k(e=>{e.disabled=true;let t=E("invalidOption",[E(l[0],l[1])]);e instanceof HTMLInputElement&&"checkbox"===e.type?(e.nextElementSibling.tabIndex=-1,(e=e.parentElement).title=t):(e.value="",e.title=t,I(e.parentElement,"click",i,"on"),e instanceof HTMLSpanElement&&(e.style.textDecoration="line-through"))},r)}})(t),I("[data-href]","mousedown",()=>{document.onmouseover=null;for(let e of r("[data-href]"))e.onmousedown=null,a(10,[e.dataset.href,-1]).then(([t])=>{e.removeAttribute("data-href"),e.href=t})},"on"),document.onmouseover=()=>{M("mousedown"),l("[data-href]").onmousedown()};let i=l("#openExtensionsPage");w&&k(e=>{let t="edge://extensions/";e.href=t+"shortcuts",e.textContent=t+"\u2026"},i),k(e=>{let t=e.children[1],i=E("NewTabAdapter");t.title=i+" - "+E("webstore")},l("#chromeExtVomnibar"));let o=e=>{v(e);let t=e.currentTarget.dataset.for.split(":").slice(-1)[0],i=r(t),o=(i.find(e=>e.checked)||i[0]).nextElementSibling;B(o,n,e=>{VApi&&VApi.x(e.parentElement.parentElement)})};for(let e of r(".ref-text")){let t=e.dataset.for,i=t.slice(t.indexOf(":")+1),n=t.split(":")[0],l=T.D[n.replace("#","")],a=l.m,s=e.parentElement,u=()=>{k(([e,t,i])=>{let n=i.find(e=>e.checked)||i[0];if(e.textContent=E(n.checked?"145_2":"144"),t){let e=n.nextElementSibling,i=e.getAttribute("data-i2");t.textContent=i?V(i):e.textContent}},[s.querySelector(".status-of-related"),s.querySelector(".name-of-related"),i!==t?r(i):[l.x]])};l.m=()=>(u(),a.call(l)),I(e,"click",o,"on"),I(l.x,"change",u,true)}},N=()=>{P(),P=N=null,d||k(e=>{e.textContent="Cmd"},l("#Ctrl"));for(let e in T.D)T.D[e].m();k(()=>{document.documentElement.classList.remove("loading")}),u.then(s),location.hash&&k(window.onhashchange),h(0,8),T.D.keyMappings.m=()=>a(7).then($);let e=matchMedia("(prefers-color-scheme: dark)"),t=()=>{setTimeout(n,34)},i=T.D.autoDarkMode,n=()=>{let t=i.z(),n=2===t?!!e&&e.matches:1===t;if(VApi&&VApi.z){let e=VApi.y().r;if(e){let t=(e.firstElementChild&&"span"===e.firstElementChild.localName?e.firstElementChild:e).children;for(let e of t)if("style"!==e.localName&&(e.classList.toggle("D",n),e=e.firstElementChild||e,"iframe"===e.localName)){let t=e.classList.contains("Find"),i=e.contentDocument,o=i.querySelector("style#dark");if(o&&o.sheet&&(o.sheet.disabled=!n),i.body.classList.toggle(t?"D":"has-dark",n),t){let e=VApi.y().f;e&&e.parentElement.classList.toggle("D",n)}}}a(3,{key:"d",val:n}).then(e=>{VApi.z.d=e})}p(n?2===t?2:1:0)};i.m=t,k(()=>{2===i.S&&u.then(t),e.onchange=t}),k(()=>{setTimeout(()=>{let e=document.createElement("script");e.src="loader.js",e.async=true,document.head.append(e),document.documentElement.classList.add("smooth")},120)})},F=e=>{let t=e.target,i=e.keyCode;if(13===i)t instanceof HTMLAnchorElement?t.hasAttribute("href")||(setTimeout(e=>{c(e),e.blur()},0,t),v(e)):(e.ctrlKey||e.metaKey)&&(v(e),t.blur&&t.blur(),H()&&(M("click"),S.onclick()));else{if(32!==i)return;if(t instanceof HTMLSpanElement&&t.parentElement instanceof HTMLLabelElement){v(e);let i=t.parentElement.control;i.disabled||i.readOnly||c(i)}}};I(T.D.userDefinedCss.x,"input",C(()=>{let e=T.D.userDefinedCss,t=e.x.classList.contains("debugging");if(e.O&&!t||!VApi||!VApi.z)return;let i=e.z(),n=i===e.S,o=a(8,[i,m]),l=VApi.y().r;o.then(t=>{e.x.classList.toggle("debugging",!n),VApi.t({k:l||n?0:1,t:E("livePreview")||"Live preview CSS\u2026",H:t.ui,f:t.find});let i=l&&l.querySelector("iframe.Omnibar"),o=i&&i.contentDocument;if(o){let e=o.querySelector("style.debugged")||o.querySelector("style#custom");e||(e=o.createElement("style"),e.id="custom"),e.parentNode||o.head.append(e),e.classList.add("debugged"),e.textContent=(n?"\n":"\n.inactive { opacity: 1; }\n")+(t.omni&&t.omni+"\n"||"")}})},1200,null,0));export const noBlobSupport_cr_mv2_=()=>false;I("#importButton","click",()=>{let e=l("#importOptions");e.onchange?e.onchange(null):c(l("#settingsFile"))},"on"),k(t=>{let i=y.o,n=A,o=e;if(!n){let t=navigator.userAgentData,i=t.brands.filter(t=>(parseInt(t.version)===e&&"Chromium"!==t.brand||t.brand.includes("Opera"))&&!` ${t.brand} `.includes(" Not ")),l=i.find(e=>/\b(Edge|Opera)\b/.test(e.brand))||i[0],r=w?"MS Edge":"";n=l?l.brand:t?r||"Chromium":(/\bChromium\b/.exec(navigator.userAgent)||[""])[0]||r||"Chrome",l&&(o=parseInt(l.version))}t.textContent=n+" "+o+("Chromium"===n?" based":"")+E("comma")+E("NS")+(E(i)||i[0].toUpperCase()+i.slice(1))},l("#browserName")),document.addEventListener("keydown",e=>{if(!d&&e.metaKey)return void F(e);if(32!==e.keyCode){if(!VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;let t=VApi.r[3]({c:" ",e,i:e.keyCode,v:""},11);if("a-f12"===t){let e=l("#importOptions"),t=e.selectedIndex,i=()=>{e.onchange&&e.onchange(null),e.selectedIndex=t};l("#recommendedSettings").selected=true,null!=e.onchange?i():setTimeout(i,100)&&e.click()}else"?"===t&&l("#showCommands").click();return}let t=e.target;"span"===t.localName&&"label"===t.parentElement.localName&&e.preventDefault()});export const onHash_=e=>{let t;if((e=e.slice("!"===e[1]?2:1))&&/^[a-z][\w-]*$/i.test(e))if(t=l(`[data-hash="${e}"]`))M("click"),t.onclick&&t.onclick(null,"hash");else if(t=l(`[id="${e.replace(/-/g,"")}" i]`)){t.dataset.model&&(t="input"===t.localName&&"checked"===t.type?t.parentElement:t,t.classList.add("highlight"));let e=e=>{if(e&&e.target!==window)return;window.onload&&(window.onload=null,scrollTo({behavior:"instant",top:0,left:0})),B(t);let i=t.localName;"button"!==i&&"a"!==i||c(t)};if("complete"===document.readyState)return e();window.scrollTo(0,0),window.onload=e}};window.onhashchange=()=>{onHash_(location.hash)};let B=(e,t,i)=>{let n=-1;e.scrollIntoView({block:t?"nearest":"center",behavior:"smooth"});let o=setInterval(()=>{let t=scrollY;t===n&&(clearInterval(o),i&&i(e),e.focus()),n=t},72)};y.u().then(N),a(7).then(e=>{k($,e)}),a(12).then(e=>{"?"!==e&&k(([e,t])=>{e.textContent=t},[l("#questionShortcut"),e])}),I("#openExtensionsPage","click",e=>{v(e),a(15,{u:e.target.href,p:true})}),I(document,"click",function e(){let t=VApi,i=t&&t.y();i&&i.r&&(document.removeEventListener("click",e,true),i.r.addEventListener("click",e=>{let t,i=e.target;VApi&&i.classList.contains("HelpCommandName")&&(t=i.textContent.slice(1,-1),VApi.p({H:18,s:t}))},true),document.addEventListener("click",e=>{if("a"!==e.target.localName||!(e.ctrlKey||e.metaKey)||m<-1)return;let t=VApi,i=t&&t.b,n=i&&i.$();if(n&&n.a&&n.k&&null===n.k.c){let e=-17&n.m;e<32&&2&e&&!(1&e)&&setTimeout(()=>{m>=0&&(f.tabs?f.tabs.update(m,{active:true},()=>{}):a(25,{module:"tabs",name:"update",args:[m,{active:true}]}))},0)}}))},true),I("#testKeyInputBox","focus",function e(t){let i,n,o=t.currentTarget,r=l("#testKeyInput"),a=(e,t)=>{let i=void 0!==e?r.textContent=e:r.textContent;if(e&&0!==t&&document.activeElement===r){let t=getSelection(),i=r.firstChild;t.setBaseAndExtent(i,e.length,i,e.length)}return i},s=0,u=false;r.onkeydown=e=>{if(u&&(u=false,r.classList.remove("outline")),229!==e.keyCode&&"Process"!==e.key){if(VApi&&!g(e)){let t={c:" ",e,i:e.keyCode,v:""},o=VApi.r[3](t,11),l="esc"===o||"c-["===o,s=4&VApi.z.l?VApi.r[3](t,10):o;if(!o&&(16===t.i||"Shift"===e.key))return;let u=o.length>1?`<${o}>`:o||"(empty)",c=s===o?"":s.length>1?`<${s}>`:s||"(empty)";if(i=e,n=VApi.z.l,a(c?`${u} / ${c}`:u),"enter"===o||"tab"===o||"s-tab"===o||l||"f12"===o)return void(("enter"===o||l)&&r.blur())}s=e.keyCode,v(e)}else a("")},r.onkeyup=e=>{e.keyCode===s&&v(e)},r.onfocus=()=>{VApi&&(r.classList.add("outline"),u=true,VApi.f(7,Object.setPrototypeOf({i:true,r:0,k:"v-esc:test",p:true,h:r.previousElementSibling.textContent},null),1,0))},r.onblur=()=>{VApi&&VApi.f(16,Object.setPrototypeOf({type:"keydown",key:"Esc",esc:true},null),1,0)},r.addEventListener("compositionend",()=>{a("")}),r.onpaste=v,r.onclick=()=>{r.focus()};let c=l("#testKeyInInput");c.onchange=()=>{c.checked?r.contentEditable="true":r.removeAttribute("contenteditable"),r.focus()},o.removeEventListener("focus",e,true),o.addEventListener("blur",e=>{let t=u?e.relatedTarget:null;(t?!o.contains(t):u)&&(u=false,r.classList.remove("outline"))},true),T.V=()=>{i&&n!==VApi.z.l&&r.onkeydown(i)}},true);