"use strict";(()=>{let e,t=chrome.runtime,n=()=>{window!==top&&parent.focus(),window.closed||window.close(),e=null},a=t=>{let a=t=>{e.postMessage(t),setTimeout(n,0)},{t:o,s:r}=t,c=()=>{switch(o){case 5:case 3:let e=navigator.clipboard;return 5===o?e.writeText(r):e.readText().then(e=>{l=e});case 4:return window.fetch(r.u).then(e=>e.status<300&&e.status>199?e.blob():Promise.reject("HTTP "+e.status)).then(e=>{let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=r.t,n.target="_blank";let a=new MouseEvent("click",{bubbles:true,cancelable:true,altKey:true,detail:1,button:0,buttons:1});n.dispatchEvent(a)})}switch(o){case 1:case 9:let e=(9===o?new Promise((e,t)=>{let n=document.createElement("img");n.onload=()=>{let a=document.createElement("canvas"),o=a.width=n.naturalWidth,r=a.height=n.naturalHeight,c=a.getContext("2d");if(c)try{c.drawImage(n,0,0,o,r),a.toBlob(n=>n?e(n):t("Can not export from canvas"))}catch(e){t("Can not export tainted canvas")}else t("Can not create canvas")},n.onerror=()=>{t(0)},n.src=r.u}).catch(e=>0!==e?window.fetch(r.u):Promise.reject("Can not load image")):window.fetch(r.u)).then(e=>(r.u="",e instanceof Response?e.blob():e)).then(e=>{r.u="";let t="image/png",n={[t]:e.type===t?e:new Blob([e],{type:t})};return r.t&&(n["text/plain"]=new Blob([r.t],{type:"text/plain"})),navigator.clipboard.write([new ClipboardItem(n)])});return 9!==o&&(r.u=""),e}},i=()=>{let e;try{e=c()}catch(e){}e?e.then(()=>{a(l)},e=>{console.log("Vimium C: can not run task=%o:",o,e),a(false)}):a(false)},l=true;document.hasFocus()?i():(window.onfocus=i,window.focus())},o=false;try{e=t.connect({name:"2176"}),e.onDisconnect.addListener(n)}catch(e){return void n()}e.onMessage.addListener(e=>{let t=e;49!==t.N||o?n():(o=true,a(t))})})();