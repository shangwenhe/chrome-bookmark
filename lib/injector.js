"use strict";var VimiumInjector;(()=>{let t=VimiumInjector,e={id:"",alive:-1,host:"",version:"",cache:null,clickable:void 0,eval:null,reload:null,checkIfEnabled:null,$:null,$h:null,$m:null,$r:null,$g:null,getCommandCount:null,callback:null,destroy:null};if(t)for(let l of Object.keys(t))e[l]=t[l];e.alive=-1,e.$g=null,VimiumInjector=e})(),(function(t,e){function l(t,l){let n,i,a=VimiumInjector,m=a&&a.clickable,h=a&&a.callback;if(!t){let e=l&&l.message,c=o.id||location.host||location.protocol;if(i=!!(e&&e.lastIndexOf("not exist")>=0&&o.id),false===t?n=": not in the allow list.":!i&&l?n=e?`:\n\t${e}`:": no backend found.":s>3?(n=e?`:\n\t${e}`:`: retried but failed (${t}).`,i=false):(setTimeout(f,200*s),s++,i=true),!i){n=n||` (${s} retries).`;let t="color:red",e="color:auto";console.log("%cVimium C%c: %cfail%c to inject into %c%s%c %s",t,e,t,e,"color:#0c85e9",c,e,n),h&&a.callback(-1,n)}}a&&"function"==typeof a.destroy&&a.destroy(true);let v=t?t.h:"",b=VimiumInjector={id:d,alive:0,host:d,version:t?t.version:"",cache:null,clickable:m,eval:null,reload:e(u),checkIfEnabled:null,$:null,$h:t=>"vimium-c."+t+v,$m(t){VimiumInjector&&VimiumInjector.$r("object"==typeof t?t.t:t)},$r(){},$g:null!=r?""===r||"true"===r.toLowerCase():null,getCommandCount:null,callback:h||null,destroy:null},$=document.documentElement;if(!(t&&$ instanceof HTMLHtmlElement))return l;let g=document.contains(c)?c:(document.head||$).lastChild||document.head,k=g.nextSibling,p=g.parentElement,C=[];for(let e of t.s){let t=document.createElement("script");t.type="text/javascript",t.async=false,t.src=e,p.insertBefore(t,k),C.push(t)}C.length>0&&(C[C.length-1].onload=function(){this.onload=null;for(let t=C.length;0<=--t;)C[t].remove()}),h&&b.callback(0,"loading")}function n(){a(()=>{a(()=>{setTimeout(f,0)},{timeout:67})},{timeout:330})}let o=chrome.runtime,c=document.currentScript,u=c.src,i=u.indexOf("://")+3,r=c.dataset.blockFocus,a=requestIdleCallback,s=1,d=u.slice(i,u.indexOf("/",i));d=c.dataset.extensionId||d,VimiumInjector.id=d;let f=()=>{try{o.sendMessage(d,{handler:99,scripts:true},t=>{let e=o.lastError;return e?l(void 0,e):l(t),e})}catch(t){console.log("Can not send message to the extension of %o: %s",d,t&&t.message||t+"")}};"loading"!==document.readyState?n():addEventListener("DOMContentLoaded",n,{capture:true,once:true})})(0,t=>e=>{function l(){let l=document.documentElement,n=document.head||document.body||l,o=document.createElement("script");n&&(o.type="text/javascript",o.async=false,o.src=t,console.log("%cVimium C%c begins to reload%s.","color:red","color:auto",1===e?" because it has been updated.":""),n.append(o))}let n=VimiumInjector;if(n){let t=n.clickable;"function"==typeof n.destroy&&n.destroy(true),n.clickable=t}e?setTimeout(l,200):l()}),(!document.currentScript||"false"!==(document.currentScript.dataset.vimiumHooks||"").toLowerCase())&&null!==VimiumInjector.clickable&&(function(){VimiumInjector.clickable=VimiumInjector.clickable||new WeakSet;let t=EventTarget,e=t.prototype,l=e.addEventListener;if(true===l.vimiumHooked)return;let n=HTMLAnchorElement,o=Element,c=e.addEventListener=function addEventListener(t,e){if("click"===t&&!(this instanceof n)&&e&&this instanceof o){let t=VimiumInjector;t&&t.clickable&&t.clickable.add(this)}let c=arguments,u=c.length;return 2===u?l.call(this,t,e):3===u?l.call(this,t,e,c[2]):l.apply(this,c)},u=Function.prototype,i=u.toString,r=u.toString=function toString(){return i.apply(this===c?l:this===r?i:this,arguments)};c.vimiumHooked=true,t.vimiumRemoveHooks=()=>{delete t.vimiumRemoveHooks,e.addEventListener===c&&(e.addEventListener=l),u.toString===r&&(u.toString=i)},c.prototype=r.prototype=void 0})();